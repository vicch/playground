<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raindrop Random Picker</title>
    <style>
        /* CSS Variables for shadcn/ui theme */
        :root {
            --background: 0 0% 100%;
            --foreground: 222.2 84% 4.9%;
            --card: 0 0% 100%;
            --card-foreground: 222.2 84% 4.9%;
            --popover: 0 0% 100%;
            --popover-foreground: 222.2 84% 4.9%;
            --primary: 221.2 83.2% 53.3%;
            --primary-foreground: 210 40% 98%;
            --secondary: 210 40% 96%;
            --secondary-foreground: 222.2 84% 4.9%;
            --muted: 210 40% 96%;
            --muted-foreground: 215.4 16.3% 46.9%;
            --accent: 210 40% 96%;
            --accent-foreground: 222.2 84% 4.9%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 210 40% 98%;
            --border: 214.3 31.8% 91.4%;
            --input: 214.3 31.8% 91.4%;
            --ring: 221.2 83.2% 53.3%;
            --radius: 0.5rem;
        }

        .dark {
            --background: 222.2 84% 4.9%;
            --foreground: 210 40% 98%;
            --card: 222.2 84% 4.9%;
            --card-foreground: 210 40% 98%;
            --popover: 222.2 84% 4.9%;
            --popover-foreground: 210 40% 98%;
            --primary: 217.2 91.2% 59.8%;
            --primary-foreground: 222.2 84% 4.9%;
            --secondary: 217.2 32.6% 17.5%;
            --secondary-foreground: 210 40% 98%;
            --muted: 217.2 32.6% 17.5%;
            --muted-foreground: 215 20.2% 65.1%;
            --accent: 217.2 32.6% 17.5%;
            --accent-foreground: 210 40% 98%;
            --destructive: 0 62.8% 30.6%;
            --destructive-foreground: 210 40% 98%;
            --border: 217.2 32.6% 17.5%;
            --input: 217.2 32.6% 17.5%;
            --ring: 224.3 76.3% 94.1%;
        }

        /* Utility functions */
        .hsl {
            color: hsl(var(--foreground));
        }

        .bg-background {
            background-color: hsl(var(--background));
        }

        .bg-card {
            background-color: hsl(var(--card));
        }

        .bg-primary {
            background-color: hsl(var(--primary));
        }

        .bg-secondary {
            background-color: hsl(var(--secondary));
        }

        .bg-muted {
            background-color: hsl(var(--muted));
        }

        .bg-destructive {
            background-color: hsl(var(--destructive));
        }

        .text-foreground {
            color: hsl(var(--foreground));
        }

        .text-card-foreground {
            color: hsl(var(--card-foreground));
        }

        .text-primary-foreground {
            color: hsl(var(--primary-foreground));
        }

        .text-secondary-foreground {
            color: hsl(var(--secondary-foreground));
        }

        .text-muted-foreground {
            color: hsl(var(--muted-foreground));
        }

        .text-destructive {
            color: hsl(var(--destructive));
        }

        .border-border {
            border-color: hsl(var(--border));
        }

        .border-input {
            border-color: hsl(var(--input));
        }

        /* Base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Layout */
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .mx-auto {
            margin-left: auto;
            margin-right: auto;
        }

        .w-full {
            width: 100%;
        }

        .max-w-md {
            max-width: 28rem;
        }

        .max-w-lg {
            max-width: 32rem;
        }

        .max-w-2xl {
            max-width: 42rem;
        }

        /* Spacing */
        .p-0 { padding: 0; }
        .p-1 { padding: 0.25rem; }
        .p-2 { padding: 0.5rem; }
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .p-8 { padding: 2rem; }

        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }

        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
        .py-8 { padding-top: 2rem; padding-bottom: 2rem; }

        .m-0 { margin: 0; }
        .m-1 { margin: 0.25rem; }
        .m-2 { margin: 0.5rem; }
        .m-3 { margin: 0.75rem; }
        .m-4 { margin: 1rem; }
        .m-6 { margin: 1.5rem; }
        .m-8 { margin: 2rem; }

        .mb-0 { margin-bottom: 0; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }

        .mt-0 { margin-top: 0; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-3 { margin-top: 0.75rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .mt-8 { margin-top: 2rem; }

        /* Typography */
        .text-xs { font-size: 0.75rem; line-height: 1rem; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .text-base { font-size: 1rem; line-height: 1.5rem; }
        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
        .text-2xl { font-size: 1.5rem; line-height: 2rem; }
        .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }

        .font-normal { font-weight: 400; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }

        .leading-none { line-height: 1; }
        .leading-tight { line-height: 1.25; }
        .leading-snug { line-height: 1.375; }
        .leading-normal { line-height: 1.5; }
        .leading-relaxed { line-height: 1.625; }

        /* Display */
        .block { display: block; }
        .inline-block { display: inline-block; }
        .inline { display: inline; }
        .flex { display: flex; }
        .inline-flex { display: inline-flex; }
        .grid { display: grid; }
        .hidden { display: none; }

        /* Flexbox */
        .flex-col { flex-direction: column; }
        .flex-row { flex-direction: row; }
        .flex-wrap { flex-wrap: wrap; }
        .items-center { align-items: center; }
        .items-start { align-items: flex-start; }
        .items-end { align-items: flex-end; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .justify-start { justify-content: flex-start; }
        .justify-end { justify-content: flex-end; }

        /* Gap */
        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }

        /* Text alignment */
        .text-left { text-align: left; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }

        /* Borders */
        .border { border-width: 1px; }
        .border-0 { border-width: 0px; }
        .border-2 { border-width: 2px; }

        .rounded { border-radius: 0.25rem; }
        .rounded-md { border-radius: 0.375rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .rounded-2xl { border-radius: 1rem; }
        .rounded-full { border-radius: 9999px; }

        /* Shadows */
        .shadow-sm {
            box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        }

        .shadow {
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        }

        .shadow-md {
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }

        .shadow-lg {
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        /* Card component */
        .card {
            background-color: hsl(var(--card));
            color: hsl(var(--card-foreground));
            border-radius: var(--radius);
            border: 1px solid hsl(var(--border));
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        }

        .card-header {
            display: flex;
            flex-direction: column;
            space-y: 1.5rem;
            padding: 1.5rem;
            border-bottom: 1px solid hsl(var(--border));
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            line-height: 1;
            letter-spacing: -0.025em;
        }

        .card-description {
            color: hsl(var(--muted-foreground));
            font-size: 0.875rem;
            line-height: 1.25rem;
        }

        .card-content {
            padding: 1.5rem;
        }

        .card-footer {
            display: flex;
            align-items: center;
            padding: 1.5rem;
            border-top: 1px solid hsl(var(--border));
        }

        /* Button component */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 500;
            transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            cursor: pointer;
            border: 1px solid transparent;
            text-decoration: none;
            min-height: 2.5rem;
            padding: 0.5rem 1rem;
        }

        .btn:focus-visible {
            outline: 2px solid hsl(var(--ring));
            outline-offset: 2px;
        }

        .btn:disabled {
            pointer-events: none;
            opacity: 0.5;
        }

        .btn-primary {
            background-color: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
        }

        .btn-primary:hover {
            background-color: hsl(var(--primary) / 0.9);
        }

        .btn-secondary {
            background-color: hsl(var(--secondary));
            color: hsl(var(--secondary-foreground));
        }

        .btn-secondary:hover {
            background-color: hsl(var(--secondary) / 0.8);
        }

        .btn-outline {
            border: 1px solid hsl(var(--border));
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
        }

        .btn-outline:hover {
            background-color: hsl(var(--accent));
            color: hsl(var(--accent-foreground));
        }

        .btn-destructive {
            background-color: hsl(var(--destructive));
            color: hsl(var(--destructive-foreground));
        }

        .btn-destructive:hover {
            background-color: hsl(var(--destructive) / 0.9);
        }

        .btn-sm {
            height: 2.25rem;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
        }

        .btn-lg {
            height: 2.75rem;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
        }

        /* Input component */
        .input {
            display: flex;
            height: 2.5rem;
            width: 100%;
            border-radius: var(--radius);
            border: 1px solid hsl(var(--input));
            background-color: hsl(var(--background));
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .input:focus {
            outline: 2px solid hsl(var(--ring));
            outline-offset: 2px;
        }

        .input:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* Label component */
        .label {
            color: hsl(var(--foreground));
            font-size: 0.875rem;
            font-weight: 500;
            line-height: 1;
        }

        /* Alert component */
        .alert {
            position: relative;
            width: 100%;
            padding: 1rem;
            border-radius: var(--radius);
            border: 1px solid transparent;
        }

        .alert-default {
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            border-color: hsl(var(--border));
        }

        .alert-destructive {
            background-color: hsl(var(--destructive) / 0.1);
            color: hsl(var(--destructive));
            border-color: hsl(var(--destructive) / 0.2);
        }

        .alert-info {
            background-color: hsl(var(--primary) / 0.1);
            color: hsl(var(--primary));
            border-color: hsl(var(--primary) / 0.2);
        }

        /* Badge component */
        .badge {
            display: inline-flex;
            align-items: center;
            border-radius: var(--radius);
            border: 1px solid transparent;
            font-size: 0.75rem;
            font-weight: 500;
            line-height: 1;
            padding: 0.25rem 0.5rem;
            transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .badge-secondary {
            background-color: hsl(var(--secondary));
            color: hsl(var(--secondary-foreground));
        }

        /* Separator component */
        .separator {
            margin: 1rem 0;
            height: 1px;
            background-color: hsl(var(--border));
        }

        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 1.5rem;
            height: 1.5rem;
            border: 2px solid hsl(var(--border));
            border-radius: 50%;
            border-top-color: hsl(var(--primary));
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .card-content {
                padding: 1rem;
            }

            .btn {
                width: 100%;
                margin: 0.25rem 0;
            }

            .flex {
                flex-direction: column;
            }
        }

        /* Custom styles for this app */
        .page-card {
            background-color: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.2s ease;
        }

        .page-card:hover {
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }

        .page-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: hsl(var(--foreground));
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .page-link {
            color: hsl(var(--primary));
            text-decoration: none;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 1rem;
            display: block;
            word-break: break-all;
        }

        .page-link:hover {
            text-decoration: underline;
        }

        .page-excerpt {
            color: hsl(var(--muted-foreground));
            font-size: 0.875rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .page-cover {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: var(--radius);
            margin: 1rem 0;
            border: 1px solid hsl(var(--border));
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .instructions {
            background-color: hsl(var(--muted) / 0.3);
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .instructions h3 {
            color: hsl(var(--foreground));
            margin-bottom: 1rem;
        }

        .instructions ol {
            color: hsl(var(--muted-foreground));
            margin-left: 1.5rem;
        }

        .instructions li {
            margin-bottom: 0.5rem;
            line-height: 1.5;
        }

        .instructions a {
            color: hsl(var(--primary));
            text-decoration: none;
        }

        .instructions a:hover {
            text-decoration: underline;
        }

        .instructions code {
            background-color: hsl(var(--muted));
            color: hsl(var(--foreground));
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-family: ui-monospace, SFMono-Regular, "SF Mono", Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.875em;
        }
    </style>
</head>
<body>
    <div class="container mx-auto">
        <div class="card max-w-2xl mx-auto">
            <div class="card-header text-center">
                <h1 class="card-title">🌧️ Raindrop Random Picker</h1>
                <p class="card-description">Discover your saved pages randomly</p>
            </div>

            <div class="card-content">
                <!-- Authentication Section -->
                <div id="authSection">
                    <h2 class="text-xl font-semibold text-center mb-6">Connect to Raindrop</h2>
                    
                    <div class="instructions">
                        <h3 class="text-lg font-medium">🔐 OAuth Authentication</h3>
                        <p class="text-sm text-muted-foreground mb-4">This app uses OAuth to securely connect to your Raindrop account. Click the button below to authorize access to your saved pages.</p>
                        <div class="bg-muted p-3 rounded text-sm">
                            <p class="mb-1"><strong>What happens next:</strong></p>
                            <ol class="ml-4">
                                <li>You'll be redirected to Raindrop's authorization page</li>
                                <li>Sign in and grant permission to this app</li>
                                <li>You'll be redirected back here automatically</li>
                                <li>The app will securely access your saved pages</li>
                            </ol>
                        </div>
                    </div>

                    <div class="text-center">
                        <button id="authBtn" class="btn btn-primary">🔐 Connect with Raindrop</button>
                    </div>
                </div>

                <!-- Status Messages -->
                <div id="status" class="alert hidden"></div>

                <!-- Loading State -->
                <div id="loading" class="text-center py-8 hidden">
                    <div class="spinner mb-4"></div>
                    <p class="text-muted-foreground">Loading your saved pages...</p>
                </div>

                <!-- Stats Section -->
                <div id="statsSection" class="bg-muted rounded-lg p-4 text-center mb-6 hidden">
                    <h3 class="text-lg font-semibold mb-2">📊 Your Collection</h3>
                    <p id="statsText" class="text-muted-foreground"></p>
                </div>

                <!-- Main Actions -->
                <div id="mainActions" class="text-center hidden">
                    <div class="flex gap-3 justify-center flex-wrap">
                        <button id="randomBtn" class="btn btn-primary">🎲 Pick Random Page</button>
                        <button id="refreshBtn" class="btn btn-secondary">🔄 Refresh</button>
                        <button id="logoutBtn" class="btn btn-outline">🚪 Logout</button>
                    </div>
                </div>

                <!-- Selected Page Display -->
                <div id="pageDisplay" class="hidden"></div>
            </div>
        </div>
    </div>

    <script>
        class RaindropApp {
            constructor() {
                this.clientId = '6887b3826ad0dc928887828a';
                this.clientSecret = 'de95ca64-d33f-424e-9423-18345a9116cd';
                this.redirectUri = 'https://vicch.github.io/playground/raindrop/random.html';
                this.accessToken = localStorage.getItem('raindrop_access_token');
                this.pages = [];
                this.currentPage = null;

                this.init();
            }

            init() {
                this.bindEvents();
                this.checkAuth();
            }

            bindEvents() {
                document.getElementById('authBtn').addEventListener('click', () => this.authenticate());
                document.getElementById('randomBtn').addEventListener('click', () => this.pickRandomPage());
                document.getElementById('refreshBtn').addEventListener('click', () => this.fetchPages());
                document.getElementById('logoutBtn').addEventListener('click', () => this.logout());
            }

            checkAuth() {
                // Check if we have a code parameter from OAuth callback
                const urlParams = new URLSearchParams(window.location.search);
                const code = urlParams.get('code');
                const error = urlParams.get('error');

                if (error) {
                    this.showStatus(`OAuth error: ${error}`, 'destructive');
                    this.showAuthSection();
                    return;
                }

                if (code) {
                    // We have an authorization code, exchange it for access token
                    this.exchangeCodeForToken(code);
                } else if (this.accessToken) {
                    // We have a stored access token
                    this.showMainInterface();
                    this.fetchPages();
                } else {
                    // No authentication, show auth section
                    this.showAuthSection();
                }
            }

            authenticate() {
                // Redirect to Raindrop OAuth authorization page
                const authUrl = `https://api.raindrop.io/v1/oauth/authorize?client_id=${this.clientId}&redirect_uri=${encodeURIComponent(this.redirectUri)}&response_type=code`;
                window.location.href = authUrl;
            }

            async exchangeCodeForToken(code) {
                try {
                    this.showLoading(true);
                    this.showStatus('Exchanging authorization code for access token...', 'info');

                    // Make direct request to Raindrop API with proper CORS headers
                    const response = await fetch('https://api.raindrop.io/v1/oauth/access_token', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                            'Accept': 'application/json',
                        },
                        credentials: 'omit', // Don't send cookies
                        body: new URLSearchParams({
                            client_id: this.clientId,
                            client_secret: this.clientSecret,
                            grant_type: 'authorization_code',
                            code: code,
                            redirect_uri: this.redirectUri
                        })
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('Token exchange response:', response.status, errorText);
                        throw new Error(`Token exchange failed: ${response.status} ${response.statusText}`);
                    }

                    const data = await response.json();
                    this.accessToken = data.access_token;
                    localStorage.setItem('raindrop_access_token', this.accessToken);
                    
                    // Clean up URL by removing the code parameter
                    window.history.replaceState({}, document.title, window.location.pathname);
                    
                    this.showStatus('Successfully authenticated with Raindrop!', 'default');
                    this.showMainInterface();
                    this.fetchPages();
                } catch (error) {
                    console.error('Token exchange error:', error);
                    
                    // Check if it's a CORS error and provide specific guidance
                    if (error.message.includes('CORS') || error.message.includes('cors') || error.message.includes('Failed to fetch')) {
                        this.showStatus('CORS error during authentication. This might be due to the redirect URI mismatch. Please check your Raindrop app settings.', 'destructive');
                        this.showCorsSolutions();
                    } else {
                        this.showStatus(`Authentication failed: ${error.message}`, 'destructive');
                    }
                    this.showAuthSection();
                } finally {
                    this.showLoading(false);
                }
            }

            logout() {
                this.accessToken = null;
                this.pages = [];
                this.currentPage = null;
                localStorage.removeItem('raindrop_access_token');
                this.showAuthSection();
                this.showStatus('Logged out successfully.', 'default');
            }

            async fetchPages() {
                if (!this.accessToken) {
                    this.showStatus('No access token available. Please authenticate first.', 'destructive');
                    return;
                }

                try {
                    this.showLoading(true);
                    this.showStatus('Fetching your saved pages...', 'info');

                    // Make direct request to Raindrop API with proper CORS headers
                    const response = await fetch('https://api.raindrop.io/v1/raindrops/0', {
                        headers: {
                            'Authorization': `Bearer ${this.accessToken}`,
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        credentials: 'omit' // Don't send cookies
                    });

                    if (!response.ok) {
                        if (response.status === 401) {
                            // Token invalid
                            localStorage.removeItem('raindrop_access_token');
                            this.accessToken = null;
                            this.showStatus('Session expired. Please authenticate again.', 'destructive');
                            this.showAuthSection();
                            return;
                        }
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const data = await response.json();
                    this.pages = data.items || [];
                    
                    this.showStatus(`Successfully loaded ${this.pages.length} pages!`, 'default');
                    this.updateStats();
                } catch (error) {
                    console.error('Fetch error:', error);
                    
                    // Check if it's a CORS error
                    if (error.message.includes('CORS') || error.message.includes('cors') || error.message.includes('Failed to fetch')) {
                        this.showStatus('CORS error detected. Please try one of these solutions:', 'destructive');
                        this.showCorsSolutions();
                    } else {
                        this.showStatus(`Error fetching pages: ${error.message}`, 'destructive');
                    }
                } finally {
                    this.showLoading(false);
                }
            }

            showCorsSolutions() {
                const pageDisplay = document.getElementById('pageDisplay');
                pageDisplay.innerHTML = `
                    <div class="page-card">
                        <h2 class="page-title">🚫 CORS Error - Solutions</h2>
                        <p class="page-excerpt">The CORS error might be due to redirect URI mismatch. Here are solutions:</p>
                        
                        <div class="mb-4">
                            <h3 class="text-lg font-semibold mb-2">Option 1: Check Raindrop App Settings</h3>
                            <p class="text-sm text-muted-foreground mb-2">Verify your redirect URI in Raindrop Developer Settings:</p>
                            <div class="bg-muted p-3 rounded text-sm font-mono">
                                <p class="mb-1">Redirect URI should be exactly:</p>
                                <p class="mb-1">https://vicch.github.io/playground/raindrop/random.html</p>
                            </div>
                            <p class="text-sm text-muted-foreground">Make sure there are no extra spaces or characters.</p>
                        </div>

                        <div class="mb-4">
                            <h3 class="text-lg font-semibold mb-2">Option 2: Use a Browser Extension</h3>
                            <p class="text-sm text-muted-foreground mb-2">Install a CORS browser extension:</p>
                            <ul class="text-sm text-muted-foreground ml-4 mb-4">
                                <li>• <a href="https://chrome.google.com/webstore/detail/cors-unblock/lfhmikememgdcahcdlaciloancbhjino" target="_blank" class="text-primary">CORS Unblock (Chrome)</a></li>
                                <li>• <a href="https://addons.mozilla.org/en-US/firefox/addon/cors-everywhere/" target="_blank" class="text-primary">CORS Everywhere (Firefox)</a></li>
                            </ul>
                            <p class="text-sm text-muted-foreground">Enable the extension and refresh this page.</p>
                        </div>

                        <div class="mb-4">
                            <h3 class="text-lg font-semibold mb-2">Option 3: Local Development</h3>
                            <p class="text-sm text-muted-foreground mb-2">Run this app locally to test:</p>
                            <div class="bg-muted p-3 rounded text-sm font-mono">
                                <p class="mb-1"># Clone and run locally</p>
                                <p class="mb-1">git clone https://github.com/vicch/playground.git</p>
                                <p class="mb-1">cd playground</p>
                                <p class="mb-1">python -m http.server 8000</p>
                                <p class="mb-1"># Visit: http://localhost:8000/raindrop/random.html</p>
                            </div>
                            <p class="text-sm text-muted-foreground">Update redirect URI to: <code>http://localhost:8000/raindrop/random.html</code></p>
                        </div>

                        <div class="separator"></div>
                        <div class="text-center">
                            <button onclick="location.reload()" class="btn btn-primary">🔄 Try Again</button>
                            <button onclick="window.raindropApp.showAuthSection()" class="btn btn-secondary ml-2">🔙 Back to Auth</button>
                        </div>
                    </div>
                `;
                pageDisplay.classList.remove('hidden');
            }

            showOAuthCorsSolutions() {
                const pageDisplay = document.getElementById('pageDisplay');
                pageDisplay.innerHTML = `
                    <div class="page-card">
                        <h2 class="page-title">🔐 OAuth CORS Error - Solutions</h2>
                        <p class="page-excerpt">The OAuth token exchange is failing due to CORS restrictions. Here are solutions specifically for OAuth:</p>
                        
                        <div class="mb-4">
                            <h3 class="text-lg font-semibold mb-2">Option 1: Browser Extension (Recommended)</h3>
                            <p class="text-sm text-muted-foreground mb-2">Install a CORS browser extension that supports POST requests:</p>
                            <ul class="text-sm text-muted-foreground ml-4 mb-4">
                                <li>• <a href="https://chrome.google.com/webstore/detail/cors-unblock/lfhmikememgdcahcdlaciloancbhjino" target="_blank" class="text-primary">CORS Unblock (Chrome)</a></li>
                                <li>• <a href="https://addons.mozilla.org/en-US/firefox/addon/cors-everywhere/" target="_blank" class="text-primary">CORS Everywhere (Firefox)</a></li>
                            </ul>
                            <p class="text-sm text-muted-foreground">Enable the extension, refresh this page, and try the OAuth flow again.</p>
                        </div>

                        <div class="mb-4">
                            <h3 class="text-lg font-semibold mb-2">Option 2: Local Development Server</h3>
                            <p class="text-sm text-muted-foreground mb-2">Run this app locally to avoid CORS issues:</p>
                            <div class="bg-muted p-3 rounded text-sm font-mono">
                                <p class="mb-1"># Clone your repository locally</p>
                                <p class="mb-1">git clone https://github.com/vicch/playground.git</p>
                                <p class="mb-1">cd playground</p>
                                <p class="mb-1"># Start a local server</p>
                                <p class="mb-1">python -m http.server 8000</p>
                                <p class="mb-1"># Visit: http://localhost:8000/raindrop/random.html</p>
                            </div>
                        </div>

                        <div class="mb-4">
                            <h3 class="text-lg font-semibold mb-2">Option 3: Use a Different Redirect URI</h3>
                            <p class="text-sm text-muted-foreground mb-2">Update your Raindrop app settings to use a local redirect URI:</p>
                            <div class="bg-muted p-3 rounded text-sm font-mono">
                                <p class="mb-1"># In Raindrop Developer Settings, change redirect URI to:</p>
                                <p class="mb-1">http://localhost:8000/raindrop/random.html</p>
                            </div>
                        </div>

                        <div class="mb-4">
                            <h3 class="text-lg font-semibold mb-2">Option 4: Manual Token Exchange</h3>
                            <p class="text-sm text-muted-foreground mb-2">If all else fails, you can manually exchange the code:</p>
                            <div class="bg-muted p-3 rounded text-sm">
                                <p class="mb-1">1. Copy the authorization code from the URL</p>
                                <p class="mb-1">2. Use curl or Postman to exchange it:</p>
                                <p class="mb-1 font-mono">curl -X POST https://api.raindrop.io/v1/oauth/access_token \\</p>
                                <p class="mb-1 font-mono">  -d "client_id=6887b3826ad0dc928887828a" \\</p>
                                <p class="mb-1 font-mono">  -d "client_secret=de95ca64-d33f-424e-9423-18345a9116cd" \\</p>
                                <p class="mb-1 font-mono">  -d "grant_type=authorization_code" \\</p>
                                <p class="mb-1 font-mono">  -d "code=YOUR_CODE_HERE" \\</p>
                                <p class="mb-1 font-mono">  -d "redirect_uri=https://vicch.github.io/playground/raindrop/random.html"</p>
                            </div>
                        </div>

                        <div class="separator"></div>
                        <div class="text-center">
                            <button onclick="location.reload()" class="btn btn-primary">🔄 Try Again</button>
                            <button onclick="window.raindropApp.showAuthSection()" class="btn btn-secondary ml-2">🔙 Back to Auth</button>
                        </div>
                    </div>
                `;
                pageDisplay.classList.remove('hidden');
            }

            pickRandomPage() {
                if (this.pages.length === 0) {
                    this.showStatus('No pages available. Please refresh your collection.', 'destructive');
                    return;
                }

                const randomIndex = Math.floor(Math.random() * this.pages.length);
                this.currentPage = this.pages[randomIndex];
                this.displayPage(this.currentPage);
            }

            displayPage(page) {
                const pageDisplay = document.getElementById('pageDisplay');
                
                const tags = page.tags ? page.tags.map(tag => `<span class="badge badge-secondary">${tag}</span>`).join('') : '';
                const cover = page.cover ? `<img src="${page.cover}" alt="Cover" class="page-cover" onerror="this.style.display='none'">` : '';
                
                pageDisplay.innerHTML = `
                    <div class="page-card">
                        <h2 class="page-title">${page.title || 'Untitled'}</h2>
                        <a href="${page.link}" class="page-link" target="_blank">${page.link}</a>
                        ${cover}
                        ${page.excerpt ? `<p class="page-excerpt">${page.excerpt}</p>` : ''}
                        ${tags ? `<div class="tags">${tags}</div>` : ''}
                        <div class="separator"></div>
                        <div class="text-center">
                            <a href="${page.link}" target="_blank" class="btn btn-primary">🔗 Open in New Tab</a>
                        </div>
                    </div>
                `;
                
                pageDisplay.classList.remove('hidden');
            }

            updateStats() {
                const statsSection = document.getElementById('statsSection');
                const statsText = document.getElementById('statsText');
                
                statsText.textContent = `You have ${this.pages.length} saved pages in your collection`;
                statsSection.classList.remove('hidden');
            }

            showAuthSection() {
                document.getElementById('authSection').classList.remove('hidden');
                document.getElementById('mainActions').classList.add('hidden');
                document.getElementById('pageDisplay').classList.add('hidden');
                document.getElementById('statsSection').classList.add('hidden');
            }

            showMainInterface() {
                document.getElementById('authSection').classList.add('hidden');
                document.getElementById('mainActions').classList.remove('hidden');
            }

            showLoading(show) {
                const loading = document.getElementById('loading');
                if (show) {
                    loading.classList.remove('hidden');
                } else {
                    loading.classList.add('hidden');
                }
            }

            showStatus(message, type) {
                const status = document.getElementById('status');
                status.textContent = message;
                status.className = `alert alert-${type}`;
                status.classList.remove('hidden');
                
                // Auto-hide success messages after 5 seconds
                if (type === 'default') {
                    setTimeout(() => {
                        status.classList.add('hidden');
                    }, 5000);
                }
            }
        }

        // Initialize the app when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.raindropApp = new RaindropApp();
        });
    </script>
</body>
</html>
